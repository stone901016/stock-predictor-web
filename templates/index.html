<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è‚¡ç¥¨åˆ†æç³»çµ±</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select, button { margin: 5px; padding: 5px; }
  </style>
</head>
<body>
  <h1>ğŸ“ˆ è‚¡ç¥¨åˆ†æç³»çµ±</h1>

  <form id="analyzeForm">
    <label>è‚¡ç¥¨ä»£è™Ÿï¼š<input type="text" id="symbol" required></label><br>

    <label>é¸æ“‡è³‡æ–™å€é–“ï¼š</label>
    <select id="date_mode">
      <option value="range">ğŸ“† è‡ªè¨‚èµ·è¨–æ—¥æœŸ</option>
      <option value="year">ğŸ“… æœ€è¿‘å¹¾å¹´</option>
      <option value="all">ğŸ•°ï¸ å¾ä¸Šå¸‚è‡³ä»Š</option>
    </select><br>

    <div id="date_range">
      <label>èµ·å§‹æ—¥æœŸï¼š<input type="date" id="start_date"></label>
      <label>çµæŸæ—¥æœŸï¼š<input type="date" id="end_date"></label><br>
    </div>

    <div id="year_range" style="display:none">
      <label>æœ€è¿‘å¹¾å¹´ï¼š<input type="number" id="years" value="3" min="1"></label><br>
    </div>

    <label>è³‡æ–™é »ç‡ï¼š
      <select id="interval">
        <option value="1d">æ—¥è³‡æ–™</option>
        <option value="1wk">é€±è³‡æ–™</option>
        <option value="1mo">æœˆè³‡æ–™</option>
      </select>
    </label><br>

    <button type="submit">é–‹å§‹åˆ†æ</button>
  </form>

  <div id="result"></div>

  <script>
    const dateMode = document.getElementById('date_mode');
    dateMode.addEventListener('change', function () {
      document.getElementById('date_range').style.display = this.value === 'range' ? 'block' : 'none';
      document.getElementById('year_range').style.display = this.value === 'year' ? 'block' : 'none';
    });

    document.getElementById('analyzeForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const symbol = document.getElementById('symbol').value.trim().toUpperCase();
      const date_mode = document.getElementById('date_mode').value;
      const interval = document.getElementById('interval').value;

      let start_date = null, end_date = null, years = null;
      if (date_mode === 'range') {
        start_date = document.getElementById('start_date').value;
        end_date = document.getElementById('end_date').value;
      } else if (date_mode === 'year') {
        years = parseInt(document.getElementById('years').value);
      }

      document.getElementById('result').innerHTML = 'ğŸ“Š åˆ†æä¸­...';

      try {
        const res = await fetch('/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ symbol, date_mode, start_date, end_date, years, interval })
        });

        const data = await res.json();

        if (data.error) {
          document.getElementById('result').innerHTML = `<p style='color:red;'>éŒ¯èª¤ï¼š${data.error}</p>`;
          return;
        }

        let html = `<h2>${symbol} åˆ†æçµæœ</h2>`;
        html += `<p>æ¯å¹´å¹³å‡æ³¢å‹•åº¦ï¼š</p><pre>${JSON.stringify(data.volatility, null, 2)}</pre>`;
        html += `<p>æ¯å¹´å¹³å‡å ±é…¬ç‡ï¼š</p><pre>${JSON.stringify(data.avg_return, null, 2)}</pre>`;
        html += `<p>æœ€å¤§å›æ¸¬ï¼š${(data.max_drawdown * 100).toFixed(2)}%</p>`;
        html += `<p>Sharpe Ratioï¼š${data.sharpe_ratio.toFixed(2)}</p>`;
        html += `<p>Alphaï¼š${data.alpha?.toFixed(4) ?? 'N/A'}</p>`;
        html += `<p>Betaï¼š${data.beta?.toFixed(4) ?? 'N/A'}</p>`;
        html += `<img src="data:image/png;base64,${data.nav_img}" alt="NAV åœ–">`;

        document.getElementById('result').innerHTML = html;
      } catch (err) {
        document.getElementById('result').innerHTML = `<p style='color:red;'>éŒ¯èª¤ï¼š${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
