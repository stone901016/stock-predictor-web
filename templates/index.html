<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è‚¡åƒ¹é æ¸¬åˆ†æå·¥å…·</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select, button { margin: 5px; padding: 5px; }
    .chart img { max-width: 100%; margin-top: 15px; }
  </style>
</head>
<body>
  <h1>ğŸ“ˆ è‚¡ç¥¨é æ¸¬ç³»çµ±</h1>

  <form id="predictForm">
    è‚¡ç¥¨ä»£è™Ÿï¼š<input type="text" id="predict_symbol" required><br>
    èµ·å§‹æ—¥æœŸï¼š<input type="date" id="predict_start" required>
    çµæŸæ—¥æœŸï¼š<input type="date" id="predict_end" required><br>
    é æ¸¬æœªä¾†å¹¾å¤©ï¼š<input type="number" id="forecast_days" value="30" min="1" max="180" required><br>
    é æ¸¬æ¨¡å‹ï¼š
    <select id="model_type">
      <option value="lstm">LSTM æ¨¡å‹</option>
      <option value="random">éš¨æ©Ÿæ¼«æ­¥æ¨¡å‹</option>
      <option value="compare">æ¯”è¼ƒï¼ˆLSTM vs Randomï¼‰</option>
    </select><br>
    <button type="submit">é–‹å§‹é æ¸¬</button>
  </form>

  <div id="predict_result" class="chart"></div>

  <script>
    document.getElementById('predictForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const symbol = document.getElementById('predict_symbol').value.trim().toUpperCase();
      const start_date = document.getElementById('predict_start').value;
      const end_date = document.getElementById('predict_end').value;
      const forecast_days = parseInt(document.getElementById('forecast_days').value);
      const model_type = document.getElementById('model_type').value;

      const response = await fetch('/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ symbol, start_date, end_date, forecast_days, model_type })
      });

      const result = await response.json();

      if (result.error) {
        document.getElementById('predict_result').innerHTML = `<p style="color:red;">${result.error}</p>`;
        return;
      }

      let html = `<h3>${symbol} é æ¸¬çµæœï¼ˆ${model_type.toUpperCase()}ï¼Œæœªä¾† ${forecast_days} å¤©ï¼‰</h3>`;
      html += `<img src="data:image/png;base64,${result.predict_img}" alt="é æ¸¬åœ–">`;

      if (model_type === 'compare') {
        html += `<p><strong>LSTM RMSEï¼š</strong>${result.lstm_rmse.toFixed(2)}</p>`;
        html += `<p><strong>LSTM MAPEï¼š</strong>${(result.lstm_mape * 100).toFixed(2)}%</p>`;
        html += `<p><em>éš¨æ©Ÿæ¨¡å‹ä¸æä¾›èª¤å·®è©•ä¼°ã€‚</em></p>`;
      }

      document.getElementById('predict_result').innerHTML = html;
    });
  </script>
</body>
</html>
